generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============================================
// ENUMS
// ============================================

enum Role {
  advisor
  client
  admin
}

enum PersonEntity {
  Person
  Entity
}

enum Gender {
  Male
  Female
}

enum YesNo {
  Yes
  No
}

enum AccountType {
  individual
  corporation
  corporate_pension_profit_sharing
  custodial
  estate
  joint_tenant
  limited_liability_company
  individual_single_member_llc
  sole_proprietorship
  transfer_on_death_individual
  transfer_on_death_joint
  nonprofit_organization
  partnership
  exempt_organization
  trust
  other
}

enum AdditionalDesignationType {
  c_corp
  s_corp
  ugma
  utma
  partnership
}

enum TrustType {
  charitable
  living
  irrevocable_living
  family
  revocable
  irrevocable
  testamentary
}

enum TenancyClause {
  community_property
  tenants_by_entirety
  community_property_with_rights
  joint_tenants_with_rights_of_survivorship
  tenants_in_common
}

enum MaritalStatus {
  Single
  Married
  Divorced
  DomesticPartner
  Widow
  Widowed
}

enum EmploymentAffiliation {
  Employed
  SelfEmployed
  Retired
  Unemployed
  Student
  Homemaker
}

enum InvestmentKnowledgeLevel {
  Limited
  Moderate
  Extensive
  None
}

enum InvestmentType {
  commodities_futures
  equities
  etf
  fixed_annuities
  fixed_insurance
  mutual_funds
  options
  precious_metals
  real_estate
  unit_investment_trusts
  variable_annuities
  leveraged_inverse_etfs
  complex_products
  alternative_investments
  other
}

enum TaxBracket {
  zero_to_15
  fifteen_1_to_32
  thirtytwo_1_to_50
  fifty_1_plus
}

enum RiskExposure {
  Low
  Moderate
  Speculation
  HighRisk
}

enum AccountInvestmentObjective {
  Income
  LongTermGrowth
  ShortTermGrowth
}

enum LiquidityNeed {
  High
  Medium
  Low
}

enum AddressType {
  legal
  mailing
  employer
}

enum PhoneType {
  home
  business
  mobile
}

enum SignatureType {
  account_owner
  joint_account_owner
  financial_professional
  supervisor_principal
}

enum ProfileStatus {
  draft
  submitted
  approved
  rejected
}

enum AccountHolderType {
  primary
  secondary
}

// Statement of Financial Condition enums

enum StatementRowCategory {
  liquid_non_qualified
  liabilities
  net_worth
  illiquid_non_qualified
  liquid_qualified
  income_summary
  illiquid_qualified
}

enum StatementSignatureType {
  account_owner
  joint_account_owner
  financial_professional
  registered_principal
}

// ============================================
// MODELS
// ============================================

model User {
  id           String            @id @default(uuid())
  email        String            @unique
  passwordHash String            @map("password_hash")
  fullName     String            @map("full_name")
  role         Role
  createdAt    DateTime          @default(now()) @map("created_at")
  updatedAt    DateTime          @updatedAt @map("updated_at")
  
  investorProfiles InvestorProfile[]
  statementProfiles StatementProfile[]
  additionalHolderProfiles AdditionalHolderProfile[]
  altOrderProfiles AltOrderProfile[]
  accreditationProfiles AccreditationProfile[]
  
  @@map("users")
}

model InvestorProfile {
  id              String            @id @default(uuid())
  userId          String            @map("user_id")
  status          ProfileStatus     @default(draft)
  lastCompletedStep Int              @default(0) @map("last_completed_step")
  stepCompletionStatus Json?         @map("step_completion_status")
  
  // Step 1: Account Registration
  rrName          String?           @map("rr_name")
  rrNo            String?           @map("rr_no")
  customerNames   String?           @map("customer_names")
  accountNo       String?           @map("account_no")
  retirementAccount Boolean         @default(false) @map("retirement_account")
  retailAccount   Boolean           @default(false) @map("retail_account")
  otherAccountTypeText String?      @map("other_account_type_text")
  
  createdAt       DateTime          @default(now()) @map("created_at")
  updatedAt       DateTime          @updatedAt @map("updated_at")
  submittedAt     DateTime?         @map("submitted_at")
  
  user            User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  accountTypes    InvestorProfileAccountType[]
  additionalDesignations InvestorProfileAdditionalDesignation[]
  trustInformation TrustInformation?
  jointAccountInformation JointAccountInformation?
  custodialAccountInformation CustodialAccountInformation?
  transferOnDeathInformation TransferOnDeathInformation?
  patriotActInformation PatriotActInformation?
  accountHolders  AccountHolder[]
  investmentObjectives InvestmentObjectives?
  investmentValues InvestmentValue[]
  trustedContact TrustedContact?
  signatures     Signature[]
  
  @@index([userId])
  @@index([status])
  @@index([createdAt])
  @@map("investor_profiles")
}

// ============================================
// STATEMENT OF FINANCIAL CONDITION
// ============================================

model StatementProfile {
  id                 String          @id @default(uuid())
  userId             String          @map("user_id")
  status             ProfileStatus   @default(draft)
  lastCompletedPage  Int             @default(0) @map("last_completed_page")
  pageCompletionStatus Json?         @map("page_completion_status")

  // Header / registration (mirrors top of page 1)
  rrName             String?         @map("rr_name")
  rrNo               String?         @map("rr_no")
  customerNames      String?         @map("customer_names")

  // Notes
  notesPage1         String?         @map("notes_page1")
  additionalNotes    String?         @map("additional_notes")

  createdAt          DateTime        @default(now()) @map("created_at")
  updatedAt          DateTime        @updatedAt @map("updated_at")
  submittedAt        DateTime?       @map("submitted_at")

  user               User            @relation(fields: [userId], references: [id], onDelete: Cascade)

  financialRows      StatementFinancialRow[]
  signatures         StatementSignature[]

  @@index([userId])
  @@index([status])
  @@index([createdAt])
  @@map("statement_profiles")
}

model StatementFinancialRow {
  id          String               @id @default(uuid())
  statementId String               @map("statement_id")
  category    StatementRowCategory @map("category")
  rowKey      String               @map("row_key")
  label       String?              @map("label")
  value       Decimal              @db.Decimal(19, 2)
  isTotal     Boolean              @default(false) @map("is_total")

  statement   StatementProfile     @relation(fields: [statementId], references: [id], onDelete: Cascade)

  @@index([statementId])
  @@index([category])
  @@map("statement_financial_rows")
}

model StatementSignature {
  id            String                @id @default(uuid())
  statementId   String                @map("statement_id")
  signatureType StatementSignatureType @map("signature_type")
  signatureData String                @map("signature_data") // base64 encoded image
  printedName   String                @map("printed_name")
  signatureDate DateTime              @map("signature_date")

  statement     StatementProfile      @relation(fields: [statementId], references: [id], onDelete: Cascade)

  @@unique([statementId, signatureType])
  @@index([statementId])
  @@index([signatureType])
  @@map("statement_signatures")
}

// ============================================
// ADDITIONAL HOLDER / PARTICIPANT INFORMATION
// ============================================

model AdditionalHolderProfile {
  id                 String          @id @default(uuid())
  userId             String          @map("user_id")
  status             ProfileStatus   @default(draft)
  lastCompletedPage  Int             @default(0) @map("last_completed_page")
  pageCompletionStatus Json?         @map("page_completion_status")

  // Step 1: Basic Information
  accountRegistration String?       @map("account_registration")
  rrName              String?        @map("rr_name")
  rrNo                String?        @map("rr_no")
  name                String?        @map("name")
  personEntity        PersonEntity?  @map("person_entity")
  ssn                 String?        @map("ssn")
  ein                 String?        @map("ein")
  holderParticipantRole String?      @map("holder_participant_role")
  email               String?       @map("email")
  dateOfBirth         DateTime?      @map("date_of_birth")
  positionHeld        String?        @map("position_held")
  primaryCitizenship  String?        @map("primary_citizenship")
  additionalCitizenship String?      @map("additional_citizenship")
  gender              Gender?        @map("gender")
  maritalStatus       MaritalStatus[] @map("marital_status")
  employmentStatus    EmploymentAffiliation[] @map("employment_status")
  occupation          String?        @map("occupation")
  yearsEmployed       Int?           @map("years_employed")
  typeOfBusiness      String?        @map("type_of_business")
  employerName        String?        @map("employer_name")
  overallInvestmentKnowledge InvestmentKnowledgeLevel? @map("overall_investment_knowledge")
  annualIncomeFrom    Decimal?       @db.Decimal(19, 2) @map("annual_income_from")
  annualIncomeTo      Decimal?       @db.Decimal(19, 2) @map("annual_income_to")
  netWorthFrom        Decimal?       @db.Decimal(19, 2) @map("net_worth_from")
  netWorthTo          Decimal?       @db.Decimal(19, 2) @map("net_worth_to")
  liquidNetWorthFrom  Decimal?      @db.Decimal(19, 2) @map("liquid_net_worth_from")
  liquidNetWorthTo    Decimal?      @db.Decimal(19, 2) @map("liquid_net_worth_to")
  taxBracket          TaxBracket?    @map("tax_bracket")
  yearsOfInvestmentExperience Int?   @map("years_of_investment_experience")

  // Employment/Affiliation Questions
  employeeOfThisBrokerDealer YesNo?  @map("employee_of_this_broker_dealer")
  relatedToEmployeeAtThisBrokerDealer YesNo? @map("related_to_employee_at_this_broker_dealer")
  employeeName        String?        @map("employee_name")
  relationship        String?        @map("relationship")
  employeeOfAnotherBrokerDealer YesNo? @map("employee_of_another_broker_dealer")
  brokerDealerName    String?        @map("broker_dealer_name")
  relatedToEmployeeAtAnotherBrokerDealer YesNo? @map("related_to_employee_at_another_broker_dealer")
  brokerDealerName2   String?        @map("broker_dealer_name_2")
  employeeName2       String?        @map("employee_name_2")
  relationship2       String?        @map("relationship_2")
  maintainingOtherBrokerageAccounts YesNo? @map("maintaining_other_brokerage_accounts")
  withWhatFirms       String?        @map("with_what_firms")
  affiliatedWithExchangeOrFinra YesNo? @map("affiliated_with_exchange_or_finra")
  whatIsTheAffiliation String?       @map("what_is_the_affiliation")
  seniorOfficerDirectorShareholder YesNo? @map("senior_officer_director_shareholder")
  companyNames        String?        @map("company_names")

  // Signature
  signature           String?        @map("signature")
  printedName         String?        @map("printed_name")
  signatureDate       DateTime?      @map("signature_date")

  createdAt           DateTime       @default(now()) @map("created_at")
  updatedAt           DateTime       @updatedAt @map("updated_at")
  submittedAt         DateTime?      @map("submitted_at")

  user                User           @relation(fields: [userId], references: [id], onDelete: Cascade)

  addresses           AdditionalHolderAddress[]
  phones              AdditionalHolderPhone[]
  governmentIds       AdditionalHolderGovernmentId[]
  investmentKnowledge AdditionalHolderInvestmentKnowledge[]

  @@index([userId])
  @@index([status])
  @@index([createdAt])
  @@map("additional_holder_profiles")
}

model AdditionalHolderAddress {
  id                  String                @id @default(uuid())
  profileId           String                @map("profile_id")
  addressType         AddressType           @map("address_type")
  addressLine         String?               @map("address_line")
  city                String?               @map("city")
  stateProvince       String?               @map("state_province")
  zipPostalCode       String?               @map("zip_postal_code")
  country             String?               @map("country")

  profile             AdditionalHolderProfile @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@index([profileId])
  @@index([addressType])
  @@map("additional_holder_addresses")
}

model AdditionalHolderPhone {
  id                  String                @id @default(uuid())
  profileId           String                @map("profile_id")
  phoneType           PhoneType             @map("phone_type")
  phoneNumber         String?               @map("phone_number")

  profile             AdditionalHolderProfile @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@index([profileId])
  @@index([phoneType])
  @@map("additional_holder_phones")
}

model AdditionalHolderGovernmentId {
  id                  String                @id @default(uuid())
  profileId           String                @map("profile_id")
  type                String?              @map("type")
  idNumber            String?               @map("id_number")
  countryOfIssue      String?               @map("country_of_issue")
  dateOfIssue         DateTime?             @map("date_of_issue")
  dateOfExpiration    DateTime?             @map("date_of_expiration")

  profile             AdditionalHolderProfile @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@index([profileId])
  @@map("additional_holder_government_ids")
}

model AdditionalHolderInvestmentKnowledge {
  id                  String                @id @default(uuid())
  profileId           String                @map("profile_id")
  investmentType      InvestmentType        @map("investment_type")
  knowledgeLevel      InvestmentKnowledgeLevel? @map("knowledge_level")
  sinceYear           Int?                  @map("since_year")

  profile             AdditionalHolderProfile @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@unique([profileId, investmentType])
  @@index([profileId])
  @@index([investmentType])
  @@map("additional_holder_investment_knowledge")
}

// ============================================
// ALTERNATIVE INVESTMENT ORDER
// ============================================

model AltOrderProfile {
  id                 String          @id @default(uuid())
  userId             String          @map("user_id")
  status             ProfileStatus   @default(draft)
  lastCompletedPage  Int             @default(0) @map("last_completed_page")
  pageCompletionStatus Json?         @map("page_completion_status")

  // Customer/Account Information
  rrName             String?         @map("rr_name")
  rrNo               String?         @map("rr_no")
  customerNames      String?         @map("customer_names")
  proposedPrincipalAmount Decimal?   @db.Decimal(19, 2) @map("proposed_principal_amount")
  qualifiedAccount   YesNo?          @map("qualified_account")
  qualifiedAccountCertificationText String? @map("qualified_account_certification_text")
  solicitedTrade     YesNo?          @map("solicited_trade")
  taxAdvantagePurchase YesNo?        @map("tax_advantage_purchase")

  // Customer Order Information
  custodian          String?         @map("custodian")
  nameOfProduct      String?         @map("name_of_product")
  sponsorIssuer      String?         @map("sponsor_issuer")
  dateOfPpm          DateTime?       @map("date_of_ppm")
  datePpmSent        DateTime?       @map("date_ppm_sent")
  existingIlliquidAltPositions Decimal? @db.Decimal(19, 2) @map("existing_illiquid_alt_positions")
  existingIlliquidAltConcentration Decimal? @db.Decimal(5, 2) @map("existing_illiquid_alt_concentration")
  existingSemiLiquidAltPositions Decimal? @db.Decimal(19, 2) @map("existing_semi_liquid_alt_positions")
  existingSemiLiquidAltConcentration Decimal? @db.Decimal(5, 2) @map("existing_semi_liquid_alt_concentration")
  existingTaxAdvantageAltPositions Decimal? @db.Decimal(19, 2) @map("existing_tax_advantage_alt_positions")
  existingTaxAdvantageAltConcentration Decimal? @db.Decimal(5, 2) @map("existing_tax_advantage_alt_concentration")
  totalNetWorth      Decimal?        @db.Decimal(19, 2) @map("total_net_worth")
  liquidNetWorth     Decimal?        @db.Decimal(19, 2) @map("liquid_net_worth")
  totalConcentration Decimal?        @db.Decimal(5, 2) @map("total_concentration")

  // Signatures
  accountOwnerSignature String?      @map("account_owner_signature")
  accountOwnerPrintedName String?    @map("account_owner_printed_name")
  accountOwnerDate    DateTime?      @map("account_owner_date")
  jointAccountOwnerSignature String? @map("joint_account_owner_signature")
  jointAccountOwnerPrintedName String? @map("joint_account_owner_printed_name")
  jointAccountOwnerDate DateTime?    @map("joint_account_owner_date")
  financialProfessionalSignature String? @map("financial_professional_signature")
  financialProfessionalPrintedName String? @map("financial_professional_printed_name")
  financialProfessionalDate DateTime? @map("financial_professional_date")
  registeredPrincipalSignature String? @map("registered_principal_signature")
  registeredPrincipalPrintedName String? @map("registered_principal_printed_name")
  registeredPrincipalDate DateTime?  @map("registered_principal_date")

  // Internal Use Only
  notes              String?         @map("notes")
  regBiDelivery      Boolean         @default(false) @map("reg_bi_delivery")
  stateRegistration  Boolean         @default(false) @map("state_registration")
  aiInsight          Boolean         @default(false) @map("ai_insight")
  statementOfFinancialCondition Boolean @default(false) @map("statement_of_financial_condition")
  suitabilityReceived Boolean        @default(false) @map("suitability_received")

  createdAt          DateTime        @default(now()) @map("created_at")
  updatedAt          DateTime        @updatedAt @map("updated_at")
  submittedAt         DateTime?       @map("submitted_at")

  user                User            @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([status])
  @@index([createdAt])
  @@map("alt_order_profiles")
}

// ============================================
// ACCREDITED INVESTOR VERIFICATION (506C)
// ============================================

model AccreditationProfile {
  id                 String          @id @default(uuid())
  userId             String          @map("user_id")
  status             ProfileStatus   @default(draft)
  lastCompletedPage  Int             @default(0) @map("last_completed_page")
  pageCompletionStatus Json?         @map("page_completion_status")

  // Client/Account Information
  rrName             String?         @map("rr_name")
  rrNo               String?         @map("rr_no")
  customerNames      String?         @map("customer_names")
  hasJointOwner      Boolean         @default(false) @map("has_joint_owner")

  // Signatures
  accountOwnerSignature String?       @map("account_owner_signature")
  accountOwnerPrintedName String?     @map("account_owner_printed_name")
  accountOwnerDate    DateTime?      @map("account_owner_date")
  jointAccountOwnerSignature String? @map("joint_account_owner_signature")
  jointAccountOwnerPrintedName String? @map("joint_account_owner_printed_name")
  jointAccountOwnerDate DateTime?    @map("joint_account_owner_date")
  financialProfessionalSignature String? @map("financial_professional_signature")
  financialProfessionalPrintedName String? @map("financial_professional_printed_name")
  financialProfessionalDate DateTime? @map("financial_professional_date")
  registeredPrincipalSignature String?   @map("registered_principal_signature")
  registeredPrincipalPrintedName String? @map("registered_principal_printed_name")
  registeredPrincipalDate DateTime?    @map("registered_principal_date")

  createdAt          DateTime        @default(now()) @map("created_at")
  updatedAt          DateTime        @updatedAt @map("updated_at")
  submittedAt         DateTime?       @map("submitted_at")

  user                User            @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([status])
  @@index([createdAt])
  @@map("accreditation_profiles")
}

// Step 1: Many-to-Many Relationships

model InvestorProfileAccountType {
  id            String          @id @default(uuid())
  profileId     String          @map("profile_id")
  accountType   AccountType     @map("account_type")
  
  profile       InvestorProfile @relation(fields: [profileId], references: [id], onDelete: Cascade)
  
  @@unique([profileId, accountType])
  @@index([profileId])
  @@map("investor_profile_account_types")
}

model InvestorProfileAdditionalDesignation {
  id              String                @id @default(uuid())
  profileId       String                @map("profile_id")
  designationType AdditionalDesignationType @map("designation_type")
  
  profile         InvestorProfile       @relation(fields: [profileId], references: [id], onDelete: Cascade)
  
  @@unique([profileId, designationType])
  @@index([profileId])
  @@map("investor_profile_additional_designations")
}

// Step 1: Conditional Tables

model TrustInformation {
  id                String            @id @default(uuid())
  profileId         String            @unique @map("profile_id")
  establishmentDate DateTime?         @map("establishment_date")
  trustTypes        TrustType[]       @map("trust_types")
  
  profile           InvestorProfile   @relation(fields: [profileId], references: [id], onDelete: Cascade)
  
  @@map("trust_information")
}

model JointAccountInformation {
  id                String            @id @default(uuid())
  profileId         String            @unique @map("profile_id")
  areAccountHoldersMarried YesNo?     @map("are_account_holders_married")
  tenancyState      String?           @map("tenancy_state")
  numberOfTenants   Int?               @map("number_of_tenants")
  tenancyClauses    TenancyClause[]   @map("tenancy_clauses")
  
  profile           InvestorProfile   @relation(fields: [profileId], references: [id], onDelete: Cascade)
  
  @@map("joint_account_information")
}

model CustodialAccountInformation {
  id                String            @id @default(uuid())
  profileId         String            @unique @map("profile_id")
  stateGiftGiven1   String?           @map("state_gift_given_1")
  dateGiftGiven1    DateTime?        @map("date_gift_given_1")
  stateGiftGiven2   String?           @map("state_gift_given_2")
  dateGiftGiven2    DateTime?        @map("date_gift_given_2")
  
  profile           InvestorProfile   @relation(fields: [profileId], references: [id], onDelete: Cascade)
  
  @@map("custodial_account_information")
}

model TransferOnDeathInformation {
  id                    String            @id @default(uuid())
  profileId             String            @unique @map("profile_id")
  individualAgreementDate DateTime?      @map("individual_agreement_date")
  jointAgreementDate   DateTime?         @map("joint_agreement_date")
  
  profile               InvestorProfile   @relation(fields: [profileId], references: [id], onDelete: Cascade)
  
  @@map("transfer_on_death_information")
}

// Step 2: Patriot Act Information

model PatriotActInformation {
  id                      String            @id @default(uuid())
  profileId               String            @unique @map("profile_id")
  initialSourceOfFunds    String[]         @map("initial_source_of_funds")
  otherSourceOfFundsText  String?          @map("other_source_of_funds_text")
  
  profile                 InvestorProfile   @relation(fields: [profileId], references: [id], onDelete: Cascade)
  
  @@map("patriot_act_information")
}

// Step 3 & 4: Account Holder

model AccountHolder {
  id                        String            @id @default(uuid())
  profileId                 String            @map("profile_id")
  holderType                AccountHolderType  @map("holder_type")
  
  name                      String?
  email                     String?
  personEntity              PersonEntity?     @map("person_entity")
  ssn                       String?
  ein                       String?
  yesNoBox                  YesNo?            @map("yes_no_box")
  dateOfBirth               DateTime?         @map("date_of_birth")
  specifiedAdult            YesNo?            @map("specified_adult")
  primaryCitizenship        String?           @map("primary_citizenship")
  additionalCitizenship    String?           @map("additional_citizenship")
  gender                    Gender?
  generalInvestmentKnowledge InvestmentKnowledgeLevel? @map("general_investment_knowledge")
  
  createdAt                 DateTime          @default(now()) @map("created_at")
  updatedAt                 DateTime          @updatedAt @map("updated_at")
  
  profile                   InvestorProfile   @relation(fields: [profileId], references: [id], onDelete: Cascade)
  
  addresses                 AccountHolderAddress[]
  phones                    AccountHolderPhone[]
  maritalStatuses           AccountHolderMaritalStatus[]
  employmentAffiliations    AccountHolderEmploymentAffiliation[]
  employment                AccountHolderEmployment?
  investmentKnowledge       AccountHolderInvestmentKnowledge[]
  financialInformation      AccountHolderFinancialInformation?
  governmentIdentifications GovernmentIdentification[]
  advisoryFirmInformation   AdvisoryFirmInformation?
  brokerDealerInformation   BrokerDealerInformation?
  otherBrokerageAccounts    OtherBrokerageAccounts?
  exchangeFinraAffiliation  ExchangeFinraAffiliation?
  publicCompanyInformation  PublicCompanyInformation?
  
  @@index([profileId])
  @@index([holderType])
  @@map("account_holders")
}

model AccountHolderAddress {
  id                String            @id @default(uuid())
  accountHolderId    String              @map("account_holder_id")
  addressType       AddressType         @map("address_type")
  address           String?
  city              String?
  stateProvince     String?             @map("state_province")
  zipPostalCode     String?             @map("zip_postal_code")
  country           String?
  mailingSameAsLegal Boolean?            @default(false) @map("mailing_same_as_legal")
  
  accountHolder     AccountHolder       @relation(fields: [accountHolderId], references: [id], onDelete: Cascade)
  employment        AccountHolderEmployment? @relation
  
  @@index([accountHolderId])
  @@index([addressType])
  @@map("account_holder_addresses")
}

model AccountHolderPhone {
  id              String            @id @default(uuid())
  accountHolderId String            @map("account_holder_id")
  phoneType       PhoneType         @map("phone_type")
  phoneNumber     String?
  
  accountHolder   AccountHolder     @relation(fields: [accountHolderId], references: [id], onDelete: Cascade)
  
  @@index([accountHolderId])
  @@map("account_holder_phones")
}

model AccountHolderMaritalStatus {
  id              String            @id @default(uuid())
  accountHolderId String            @map("account_holder_id")
  maritalStatus   MaritalStatus    @map("marital_status")
  
  accountHolder   AccountHolder     @relation(fields: [accountHolderId], references: [id], onDelete: Cascade)
  
  @@unique([accountHolderId, maritalStatus])
  @@index([accountHolderId])
  @@map("account_holder_marital_statuses")
}

model AccountHolderEmploymentAffiliation {
  id                String                @id @default(uuid())
  accountHolderId   String                @map("account_holder_id")
  affiliation       EmploymentAffiliation
  
  accountHolder     AccountHolder         @relation(fields: [accountHolderId], references: [id], onDelete: Cascade)
  
  @@unique([accountHolderId, affiliation])
  @@index([accountHolderId])
  @@map("account_holder_employment_affiliations")
}

model AccountHolderEmployment {
  id                String            @id @default(uuid())
  accountHolderId   String            @unique @map("account_holder_id")
  occupation        String?
  yearsEmployed     Int?              @map("years_employed")
  typeOfBusiness    String?           @map("type_of_business")
  employerName      String?           @map("employer_name")
  employerAddressId String?           @unique @map("employer_address_id")
  
  accountHolder     AccountHolder     @relation(fields: [accountHolderId], references: [id], onDelete: Cascade)
  employerAddress   AccountHolderAddress? @relation(fields: [employerAddressId], references: [id], onDelete: SetNull)
  
  @@map("account_holder_employment")
}

model AccountHolderInvestmentKnowledge {
  id                String                    @id @default(uuid())
  accountHolderId   String                    @map("account_holder_id")
  investmentType    InvestmentType            @map("investment_type")
  knowledgeLevel    InvestmentKnowledgeLevel  @map("knowledge_level")
  sinceYear         String?
  otherInvestmentLabel String?                 @map("other_investment_label")
  
  accountHolder     AccountHolder             @relation(fields: [accountHolderId], references: [id], onDelete: Cascade)
  
  @@unique([accountHolderId, investmentType])
  @@index([accountHolderId])
  @@index([investmentType])
  @@map("account_holder_investment_knowledge")
}

model AccountHolderFinancialInformation {
  id                String            @id @default(uuid())
  accountHolderId   String            @unique @map("account_holder_id")
  annualIncomeFrom  Decimal?          @map("annual_income_from") @db.Decimal(19, 2)
  annualIncomeTo    Decimal?          @map("annual_income_to") @db.Decimal(19, 2)
  netWorthFrom      Decimal?          @map("net_worth_from") @db.Decimal(19, 2)
  netWorthTo        Decimal?          @map("net_worth_to") @db.Decimal(19, 2)
  liquidNetWorthFrom Decimal?         @map("liquid_net_worth_from") @db.Decimal(19, 2)
  liquidNetWorthTo  Decimal?          @map("liquid_net_worth_to") @db.Decimal(19, 2)
  taxBracket        TaxBracket?      @map("tax_bracket")
  
  accountHolder     AccountHolder     @relation(fields: [accountHolderId], references: [id], onDelete: Cascade)
  
  @@map("account_holder_financial_information")
}

model GovernmentIdentification {
  id                String            @id @default(uuid())
  accountHolderId   String            @map("account_holder_id")
  idNumber          Int               @map("id_number") // 1 or 2 to distinguish instances
  idType            String?           @map("id_type")
  idNumberValue     String?           @map("id_number_value")
  countryOfIssue    String?           @map("country_of_issue")
  dateOfIssue       DateTime?         @map("date_of_issue")
  dateOfExpiration  DateTime?         @map("date_of_expiration")
  
  accountHolder     AccountHolder     @relation(fields: [accountHolderId], references: [id], onDelete: Cascade)
  
  @@unique([accountHolderId, idNumber])
  @@index([accountHolderId])
  @@map("government_identifications")
}

model AdvisoryFirmInformation {
  id                        String            @id @default(uuid())
  accountHolderId           String            @unique @map("account_holder_id")
  employeeOfAdvisoryFirm    YesNo?           @map("employee_of_advisory_firm")
  relatedToEmployeeAdvisory YesNo?           @map("related_to_employee_advisory")
  employeeNameAndRelationship String?         @map("employee_name_and_relationship")
  
  accountHolder             AccountHolder     @relation(fields: [accountHolderId], references: [id], onDelete: Cascade)
  
  @@map("advisory_firm_information")
}

model BrokerDealerInformation {
  id                              String            @id @default(uuid())
  accountHolderId                 String            @unique @map("account_holder_id")
  employeeOfBrokerDealer         YesNo?           @map("employee_of_broker_dealer")
  brokerDealerName                String?          @map("broker_dealer_name")
  relatedToEmployeeBrokerDealer  YesNo?           @map("related_to_employee_broker_dealer")
  brokerDealerEmployeeName       String?          @map("broker_dealer_employee_name")
  brokerDealerEmployeeRelationship String?         @map("broker_dealer_employee_relationship")
  
  accountHolder                   AccountHolder     @relation(fields: [accountHolderId], references: [id], onDelete: Cascade)
  
  @@map("broker_dealer_information")
}

model OtherBrokerageAccounts {
  id                        String            @id @default(uuid())
  accountHolderId           String            @unique @map("account_holder_id")
  maintainingOtherAccounts YesNo?            @map("maintaining_other_accounts")
  withWhatFirms            String?          @map("with_what_firms")
  yearsOfInvestmentExperience Int?          @map("years_of_investment_experience")
  
  accountHolder             AccountHolder     @relation(fields: [accountHolderId], references: [id], onDelete: Cascade)
  
  @@map("other_brokerage_accounts")
}

model ExchangeFinraAffiliation {
  id                String            @id @default(uuid())
  accountHolderId   String            @unique @map("account_holder_id")
  affiliatedWithExchangeOrFinra YesNo? @map("affiliated_with_exchange_or_finra")
  affiliationDetails String?         @map("affiliation_details")
  
  accountHolder     AccountHolder     @relation(fields: [accountHolderId], references: [id], onDelete: Cascade)
  
  @@map("exchange_finra_affiliation")
}

model PublicCompanyInformation {
  id                        String            @id @default(uuid())
  accountHolderId           String            @unique @map("account_holder_id")
  seniorOfficerOr10PctShareholder YesNo?      @map("senior_officer_or_10pct_shareholder")
  companyNames              String?           @map("company_names")
  
  accountHolder             AccountHolder     @relation(fields: [accountHolderId], references: [id], onDelete: Cascade)
  
  @@map("public_company_information")
}

// Step 5: Investment Objectives

model InvestmentObjectives {
  id                        String                    @id @default(uuid())
  profileId                 String                    @unique @map("profile_id")
  riskExposure              RiskExposure[]            @map("risk_exposure")
  accountInvestmentObjectives AccountInvestmentObjective[] @map("account_investment_objectives")
  seeAttachedStatement      Boolean                   @default(false) @map("see_attached_statement")
  timeHorizonFrom           String?                   @map("time_horizon_from")
  timeHorizonTo             String?                   @map("time_horizon_to")
  liquidityNeeds            LiquidityNeed[]          @map("liquidity_needs")
  
  profile                   InvestorProfile           @relation(fields: [profileId], references: [id], onDelete: Cascade)
  
  @@map("investment_objectives")
}

model InvestmentValue {
  id                String            @id @default(uuid())
  profileId         String            @map("profile_id")
  investmentType    InvestmentType    @map("investment_type")
  value             Decimal           @db.Decimal(19, 2)
  
  profile           InvestorProfile   @relation(fields: [profileId], references: [id], onDelete: Cascade)
  
  @@unique([profileId, investmentType])
  @@index([profileId])
  @@index([investmentType])
  @@map("investment_values")
}

// Step 6: Trusted Contact

model TrustedContact {
  id                String            @id @default(uuid())
  profileId         String            @unique @map("profile_id")
  declineToProvide  Boolean           @default(false) @map("decline_to_provide")
  name              String?
  email             String?
  homePhone         String?           @map("home_phone")
  businessPhone     String?           @map("business_phone")
  mobilePhone       String?           @map("mobile_phone")
  mailingAddress    String?           @map("mailing_address")
  city              String?
  stateProvince     String?           @map("state_province")
  zipPostalCode     String?           @map("zip_postal_code")
  country           String?
  
  profile           InvestorProfile   @relation(fields: [profileId], references: [id], onDelete: Cascade)
  
  @@map("trusted_contacts")
}

// Step 7: Signatures

model Signature {
  id                String            @id @default(uuid())
  profileId         String            @map("profile_id")
  signatureType     SignatureType     @map("signature_type")
  signatureData     String            @map("signature_data") // base64 encoded image
  printedName       String            @map("printed_name")
  signatureDate     DateTime          @map("signature_date")
  
  profile           InvestorProfile   @relation(fields: [profileId], references: [id], onDelete: Cascade)
  
  @@unique([profileId, signatureType])
  @@index([profileId])
  @@index([signatureType])
  @@map("signatures")
}
